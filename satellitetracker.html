<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Apoapsys Satellite Tracking</title>
		<meta charset="utf-8">
		
		
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
		<meta name="description" content="Satellite Tracker - Real-time and simulated satellite positions and tracking"/>
		<meta property="og:description" content="Satellite Tracker - Real-time and simulated satellite positions and tracking" />
		
		<link rel="image_src" type="image/png" href="/SatTrackerSnapshot0.png" />
		<meta property="og:image" content="/SatTrackerSnapshot0.png" />
		
		
		
		<link href='http://fonts.googleapis.com/css?family=Average+Sans|Rationale' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="/lib/jquery/css/custom-theme/jquery-ui-1.10.2.custom.min.css">
		<link href="/lib/jquery/plugins/jquery.colorpicker.css" rel="stylesheet" type="text/css"/>
		<link rel="stylesheet" href="/lib/jquery/plugins/magnific-popup.css"> 
		
		<link rel="stylesheet" href="/planet.css" />
		<link rel="stylesheet" href="/satellitetracker.css" />
		
		<script src="/lib/jquery/js/jquery-1.9.1.min.js"></script>
		<script src="/lib/jquery/js/jquery-ui-1.10.2.custom.min.js"></script>
		<script src="/lib/jquery/plugins/jquery.colorpicker.js"></script>
		<script src="/lib/jquery/plugins/jquery.magnific-popup.min.js"></script>
		
		
		<script src="/lib/moment.min.js"></script>
		
		
		<script src="/lib/three.min.js"></script>
		<script src="/solarsystem.js"></script>
		<script src="/satellitetracker.js"></script>
		<script src="/lib/jquery/plugins/swatches/jquery.ui.colorpicker-pantone.js"></script>
		<script src="/lib/jquery/plugins/parts/jquery.ui.colorpicker-rgbslider.js"></script>
		<script src="/lib/jquery/plugins/parts/jquery.ui.colorpicker-memory.js"></script>
		
		<style>
			
			
			
		</style>
		<script>

		
function TimeProvider() {
	
	var realtime = true;
	var julianDay = KMG.Astro.julianNow();
	
	function setRealTime(rt) {
		realtime = rt;
	}
	
	function isRealTime() {
		return realtime;
	}
	
	function setJulianDay(jd) {
		julianDay = jd;
	}

	function getJulianDay() {
		return julianDay;
	}
	
	function getTime() {
		if (realtime) {
			return KMG.Astro.julianNow();
		} else {
			return julianDay;
		}
	}
	
	return {
		setRealTime : setRealTime,
		isRealTime : isRealTime,
		setJulianDay : setJulianDay,
		getJulianDay : getJulianDay,
		getTime : getTime
	};
};
		
function MoonPositionManager(timeProvider) {
	
	var position;
	var moonCalc = new KMG.MoonCalc();
	
	function getPosition() {
		return position;
	}

	function update(callback) {

		var jd = timeProvider.getTime();
		var moonData = moonCalc.calculateAll(jd);//
		var gmst = KMG.Astro.getGMST2(0.0, jd);

		
		var lon = moonData.position.α - gmst;
		var lat = moonData.position.δ;
		
		position = {
			lon : lon,
			lat : lat
		};
		
		if (callback) {
			callback();
		}

	}
	
	return {
		update : update,
		getPosition : getPosition
	};
}
		
function SunPositionManager(timeProvider) {
	
	var sunPosCalc = new KMG.SunlightPositioning();
	var sunRectCalc = new KMG.CustomSunOrbit();
	var position;
	
	function getPosition() {
		return position;
	}
	
	function getPositionVectorAtTime(jd) {
		return sunRectCalc.positionAtTime(jd);
	}
	
	function getPositionAtTime(jd, lat, lon) {
	
		lat = (!lat) ? 0.0 : lat;
		lon = (!lon) ? 0.0 : lon;
	
		var date = new KMG.AstroDate(undefined, jd);
		var sunData = sunPosCalc.getSunPositionOnJulianDay(jd, 0, 0, true);
		
		var gmst = KMG.Astro.getGMST2(0.0, jd);
		// These might not be the right values to use.
		var lon = sunData.details.rightAscension - gmst;
		var lat = sunData.details.declination;

		var sunVecEci = KMG.Astro.geocentricToECI(date, lat, lon, sunData.details.distance);
		var sunVecEci = new THREE.Vector3(sunVecEci.x, sunVecEci.y, sunVecEci.z);
		sunVecEci.divideScalar(KMG.AU_TO_KM);
		
		var pos = {
			lon : lon,
			lat : lat,
			alt : sunData.details.distance,
			local : sunData.details,
			eci : {
				x : sunVecEci.x,
				y : sunVecEci.y,
				z : sunVecEci.z
			}
		};
		return pos;
	}
	
	function update(callback) {
		
		position = getPositionAtTime(timeProvider.getTime());
		
		if (callback) {
			callback();
		}
		
	}
	
	return {
		getPositionAtTime : getPositionAtTime,
		getPositionVectorAtTime : getPositionVectorAtTime,
		update : update,
		getPosition : getPosition
	};
};

function EarthPositionManager(timeProvider) {
	
	var earthOrbit = new KMG.CustomEarthOrbit();
	var position;
	
	function getPosition() {
		return position;
	}
	
	function getPositionAtTime(jd) {
		var pos = earthOrbit.positionAtTime(jd);
		return pos;
	}
	
	function update(callback) {
		
		position = getPositionAtTime(timeProvider.getTime());
		
		if (callback) {
			callback();
		}
		
	}
	
	return {
		getPositionAtTime : getPositionAtTime,
		update : update,
		getPosition : getPosition
	};
};
		
function SatellitePositionsManager(id, locationProvider, timeProvider, infoLoadCallback) {
	
	
		
	var scope = this;
	var startJd = 0;
	var endJd;
	
	var info;
	var positions = [];
	var current;
	
	var orbit;
	
	var updatesEnabled = false;
	var updateCallback;
	
	var ready = false;
	var period = 1;
	
	var lastShowNumOrbits = 0;
	
	function getName() {
		if (info) {
			return info.name;
		} else {
			return "";
		}
	}
	
	function isReady() {
		return ready;
	}
	
	function setPeriod(v) {
		period = v;
	}
	
	function clearPositions() {
		startJd = 0;
		endJd = 0;
		positions = [];
		current = null;
	}
	
	function createOrbit(def) {
		var orbit;
		if (def.customOrbit) {
			// TODO: Safety check on the value of def.customOrbit
			orbit = new KMG[def.customOrbit]();
		} else if (def.elements) {
			orbit = new KMG.EllipticalOrbit((def.elements.data) ? def.elements.data : def.elements);
		}
		if (def.parentBody) {
			orbit.parentOrbit = createOrbit(def.parentBody);
		}
		return orbit;
	}
	
	function updateInfo(callback) {
		$.ajax({
			url: "/api/data/" + id,
			dataType: "json",
			error: function( jqXHR, textStatus, errorThrown ) {
				console.warn("Error: " + errorThrown);
			
			},
			success: function(data, textStatus, jqxhr) {
				
			}
		}).done(function(data) {
			
			info = data;
			orbit = createOrbit(data);
			period = data.elements.data.period;
			update();
			ready = true;
			if (callback) {
				callback();
			}
			
		});
	}
		
	function getInfo() {
		return info;
	}
	
	function getPosition() {
		return current;
	}
	
	function getPositions() {
		return positions;
	}
	
	function popPositionsPriorTo(jd) {
		
		var startLength = positions.length;
		while(positions.length > 0) {
			if (positions[0].jd < jd) {
				positions.shift();
			} else {
				break;
			}
		}
		//console.debug("Trimmed " + (startLength - positions.length) + " positions from the list");
	}
	


	function getPositionAtTime(jd) {
		var dt = jd;
		var date = new KMG.AstroDate(undefined, dt);

		equatorial = KMG.Astro.calculateSatellitePosition(date, orbit);
		azimuthal = KMG.Astro.getPositionAzimuthalSatellite(date, orbit, locationProvider.getLatitude(), locationProvider.getLongitude());

		var sun = sunManager.getPositionAtTime(jd);
		var inSunlight = KMG.Astro.isSatelliteInSunlight(jd, equatorial.xyz, sun.eci);
		
		var inLineOfSight = (azimuthal.alt > 5);

		
		var locallyVisible = false;
		// If the satellite is 6 degrees above the horizon, is in the sunlight and the sun is at least 6 degrees below the horizon
		if (azimuthal.alt > 5 && inSunlight) {
			var sun = sunManager.getPositionAtTime(jd, locationProvider.getLongitude(), locationProvider.getLatitude());
			locallyVisible = (sun.local.apparentElevationAngle <= -6);
		}
	
		
		var pos = {
			jd : dt,
			ra : equatorial.ra,
			ra_hms : equatorial.ra_hms,
			dec : equatorial.dec,
			dec_dms : equatorial.dec_dms,
			lat : equatorial.lat,
			lon : equatorial.lon,
			elevation : azimuthal.alt,
			azimuth : azimuthal.az,
			range : azimuthal.range,
			angularRange : equatorial.angularRange,
			surfaceRange : equatorial.surfaceRange,
			visibilityTimeMinutes : equatorial.visibilityTimeMinutes,
			eci : equatorial.xyz,
			inSunlight : inSunlight,
			inLineOfSight : inLineOfSight,
			locallyVisible : locallyVisible
		};
		return pos;
	}
	
	function updateTrack(callback) {
		
		var numOrbits = (mapRenderer) ? parseInt(mapRenderer.config.satellites.showNumOrbits) : 1; 
		if (numOrbits != lastShowNumOrbits) {
			clearPositions();
		}
		lastShowNumOrbits = numOrbits;
		
		if (period < 0) {
			if (callback) {
				callback(false);
			}
			return;
		}
		
		var now = timeProvider.getTime();
		startJd = (endJd > 0) ? endJd : now;
		
		
		
		endJd = now + period * numOrbits;
		var interval = (1 / 24 / 60); // 1 Minute
		for (var jd = startJd; jd <= endJd; jd += interval) {
			var pos = getPositionAtTime(jd);
			positions.push(pos);
		}
		popPositionsPriorTo(now);
			
		if (callback) {
			callback(true);
		}
	}
	
	function updateCurrent(callback) {
		
		current = getPositionAtTime(timeProvider.getTime());
	
		if (callback) {
			callback();
		}
		
	}
	
	function update() {
		if (!updatesEnabled) {
			return;
		}
		
		updateCurrent();
		updateTrack();
		
		if (updateCallback) {
			updateCallback();
		}
		
		setTimeout(function() {
			update();
		}, 500);
		
	}
	
	function startUpdates(callback) {
		if (updatesEnabled) {
			return; // Already updating
		}
		updateCallback = callback;
		updatesEnabled = true;
		
		update();
	}
	
	function stopUpdates() {
		updatesEnabled = false;
	}
	
	updateInfo(infoLoadCallback);
	
	return {
		id : id,
		getName : getName,
		isReady : isReady,
		updateTrack : updateTrack,
		getPositions : getPositions,
		updateCurrent : updateCurrent,
		getPositionAtTime : getPositionAtTime,
		getPosition : getPosition,
		updateInfo : updateInfo,
		getInfo : getInfo,
		setPeriod : setPeriod,
		clearPositions : clearPositions,
		startUpdates : startUpdates,
		stopUpdates : stopUpdates
	};
};


function LocationProvider() {
	
	var latitude = 42.35;
	var longitude = -71.05;
	
	var onChangeCallbacks = [];
	
	function setLatitude(l) {
		latitude = l;
	}
	
	function getLatitude() {
		return latitude;
	}
	
	function setLongitude(l) {
		longitude = l;
	}
	
	function getLongitude() {
		return longitude;
	}
	
	function set(lat, lon) {
		latitude = lat;
		longitude = lon;
		fireOnChangeCallback();
	}
	
	function addOnChangeCallback(cb) {
		onChangeCallbacks.push(cb);
	}
	
	function fireOnChangeCallback() {
		for (var i = 0; i < onChangeCallbacks.length; i++) {
			onChangeCallbacks[i](scope);
		}
	}
	
	function determine() {
		
		KMG.Location.getPreciseLocation(function(position) {
			if (position && position.coords) {
				setLatitude(position.coords.latitude);
				setLongitude(position.coords.longitude);
			}
			console.info(position);
			fireOnChangeCallback();
		});
		
	}
	
	var scope = {
		set : set,
		setLatitude : setLatitude,
		setLongitude : setLongitude,
		getLatitude : getLatitude,
		getLongitude : getLongitude,
		determine : determine,
		addOnChangeCallback : addOnChangeCallback
	};
	return scope;
};


var timeProvider = new TimeProvider();
var locationProvider = new LocationProvider();
var sunManager = new SunPositionManager(timeProvider);
var moonManager = new MoonPositionManager(timeProvider);
var earthManager = new EarthPositionManager(timeProvider);
var mousePosition = { x : 0, y : 0, over : false };
var satellites = {
	activeList : []
};

var mapRenderer;

var SatelliteIcons = {
	"25544" : "iss-image",
	"default" : "satellite-image"
};

function deleteSatellite(id) {
	var newSatellitesList = [];
	for (var i = 0; i < satellites.activeList.length; i++) {
		if (satellites.activeList[i].id != id) {
			newSatellitesList.push(satellites.activeList[i]);
		}
	}
	satellites.activeList = newSatellitesList;
	updateNavigationState()
}

function updateNavigationState() {
	
	initialUrl = document.location.href.split(/[?#]/)[0];
		
	var satIds = [];
	for (var i = 0; i < satellites.activeList.length; i++) {
		satIds.push(satellites.activeList[i].id);
	}
	
	console.info("Updating navigation state");
	
	var utc = !$("#simulate-use-local").prop("checked");
	var realtime = timeProvider.isRealTime();
	var jd = timeProvider.getJulianDay();
	
	var state = {
		satIds : satIds,
		config : mapRenderer.config,
		jd : jd,
		utc : utc,
		realtime : realtime
	};
	
	var query = encodeURIComponent(JSON.stringify( mapRenderer.config ));
	
	window.history.pushState(state, "Apoapsys Satellite Tracker", initialUrl + "?sats=" + satIds + "&config=" + query + "&utc=" + utc + "&rt=" + realtime + "&jd=" + jd); 

}



function loadBasic(id) {
	console.info("Loading " + id);

	var satellite = new SatellitePositionsManager(id, locationProvider, timeProvider, function() {
		var info = satellite.getInfo();
		
		updateNavigationState();
		
		satellite.startUpdates(function() {
			//renderCanvas();
		});
	});
	satellites.activeList.push(satellite);
	
}

function fmt(v, decimals) {
	if (!decimals) {
		decimals = 10000000;
	}
	return Math.floor(v * decimals) / decimals;
}


var img=new Image();
img.src="/img/texture-remove.png";

function createDetailsRow(positions, title, field, cellClass, useDeleteLink) {
	if (!cellClass) {
		cellClass = "data-table-value";
	}
	
	var pctPerCell = 1 / (positions.length + 1);
	
	
	
	var titleRow = "<tr>";
	titleRow += '<td class="data-table-label-left" style="width:' + parseInt(pctPerCell * 100) + '%">' + title + '</td>';
	for (var i = 0; i < positions.length; i++) {
	
		var deleteLink = "";
		if (useDeleteLink) {
			deleteLink = "<a href='#' class='satellite-delete-link' id='delete_sat_" + positions[i].id + "'><img title='Remove' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAEZ0FNQQAAsY58+1GTAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAMDSURBVHjabJNNbBQFGIafb2Z2dnZquwvpbkGsxrQhLSiQcOFiTDnIocS0oheDhCg/xkMjMRxI9Cg3DcQYMVqMbURDiEEh9mAaSExUTFQobH/YtQSNbNlfU/ZnZnZ3Pg+kpBHf8/s9eZPvfUVVWa1TIok1Bm9tdKPPdySTPYJSyxeWFurB+Yry/uuqy6v9showbsiRoYG+408ODzvy9Fbo7AIB7t0jvPY7ixcuNi5nbh09EOqHDwEmTPl493M7D619dgjCkFKpQL5UpK1Kcs1aeuIJcGKUpr/nm0s/fPBqW8ceAE6KHB7dse3UuoFNLPsBN2au6cLNTKbS4idfaa6PMLRrZKQvZQiW4/D39RnO/5be96bqpAWwOe4ej1pRFv9YZDE9G2TLy/vHVL9ciVmJRNJ+LkelGRAYJk7MZZMbeQ+YlHeFvbtSicmqaeO3W6Tvlg8eUf0UICNiPSrMlTek+oPAJ9vbS97z6M8Xod3iUrm6xxw2eTvue5v/rNXwa407h0LdCzBtivWIwXzBpr9cr5E1YDqX++hWobwBz+u0WgEVJTAa0JsN4S+gGHID4IQtVt1ifsmirwDcNmAq8E+fqOsbVkg2J1AKoSU8YXnQrAI3gUFwABomc1XoawNtgR/h9CdVfQ0gBDcP2EAdmkZDmXvMgO4Q3Ki59Z2YLCSU/jYQKuRbjJ+s3T8eE7EjbnSwSyEB+CHXrWrIGeDgFhMRU+OPh8QNhVQI7TbjL7T0wMo3DOHzjbbV4fg+LUXryhlUlWMm6V9j6DkLvRBFZzuj+jOcVVVUlRchcUy4eK4noVNR9LKDHjW5qqr3i7RfZNsOmyu7Tew7gOV2cLfRCkpeUHQNQxKdHcm4bViR6j84ClMB3tUW2z9TnX1Q5VdERp6J8NWoSdSNRXGS3Zg96yESgXyexlKOYr3Otz7elTZ7JlS/e2hML4sM9AoTO117+5Z1KaM71Q0q5AtFZnJL4bTX/CUXsu8L1cz/rnFFL4k85cJoFwyqEFaV+Tp8fVZ19r/efwcAxPB0rGzKVrgAAAAASUVORK5CYII=' /></a>";
		
		}
	
		var value = positions[i][field];
		value = (typeof(value) == 'number' ? fmt(value) : value);
		titleRow += '<td class="' + cellClass + '" style="width:' + parseInt(pctPerCell * 100) + '%">' + value + deleteLink + '</td>';
	}
	titleRow += "</tr>";
	
	$('#details-table > tbody:last').append(titleRow);
	
	function addDeleteLink(id) {
		//$("#delete_sat_" + id + " img").attr("src", img.src);
		
		//$("<img>").attr({
		//	src : img.src
		//}).appendTo("#delete_sat_" + id);
		
		$("#delete_sat_" + id).click(function(e) {
			deleteSatellite(id);
			e.preventDefault();
		});
	}
	
	if (useDeleteLink) {
		for (var i = 0; i < positions.length; i++) {
			
			addDeleteLink(positions[i].id);
		}
	}
}

function updateDetailsTable() {

	//details-table
	
	
	var positions = []
	for (var i = 0; i < satellites.activeList.length; i++) {
		var satellite = satellites.activeList[i];
		var position = satellite.getPosition();
		if (!position) {
			continue;
		}
		position.name = satellite.getName();
		position.id = satellite.id;
		positions.push(position);
	}
	
	
	
	$("#details-table").find("tr").remove();
	
	
	createDetailsRow(positions, "&nbsp;", "name", "data-table-label-left", true);
	
	
	createDetailsRow(positions, "Right Ascension", "ra_hms");
	createDetailsRow(positions, "Declination", "dec_dms");
	createDetailsRow(positions, "Latitude", "lat");
	createDetailsRow(positions, "Longitude", "lon");
	createDetailsRow(positions, "Altitude", "surfaceRange");
	createDetailsRow(positions, "Max Angular Range", "angularRange");
	createDetailsRow(positions, "Max Visibility Time (minutes)", "visibilityTimeMinutes");
	createDetailsRow(positions, "Range", "range");
	createDetailsRow(positions, "Azimuth", "azimuth");
	createDetailsRow(positions, "Elevation", "elevation");
		
	/*
	$('#details-table > tbody:last').append('<tr class="data-row">' + 
													'<td class="data-table-label-center">&nbsp;</td>' + 
													'<td class="data-table-label-center">Right Ascension</td>' + 
													'<td class="data-table-label-center">Declination</td>' + 
													'<td class="data-table-label-center">Latitude</td>' + 
													'<td class="data-table-label-center">Longitude</td>' + 
													'<td class="data-table-label-center">Altitude</td>' + 
													'<td class="data-table-label-center">Visible Range</td>' + 
													'<td class="data-table-label-center">Visible Time</td>' + 
													'<td class="data-table-label-center">Range</td>' + 
													'<td class="data-table-label-center">Azimuth</td>' + 
													'<td class="data-table-label-center">Elevation</td>' + 
													'</tr>');
	
		for (var i = 0; i < satellites.length; i++) {
		var satellite = satellites[i];
		var position = satellite.getPosition();
		if (!position) {
			continue;
		}
		
		$('#details-table > tbody:last').append('<tr class="data-row">' + 
													'<td class="data-table-label">' + satellite.getName() + '</td>' + 
													'<td class="data-table-value-center">' + position.ra_hms + '</td>' + 
													'<td class="data-table-value-center">' + position.dec_dms + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.lat, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.lon, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.surfaceRange, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.angularRange, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.visibilityTimeMinutes, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.range, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.azimuth, 100) + '</td>' + 
													'<td class="data-table-value-center">' + fmt(position.elevation, 100) + '</td>' + 
													"</tr>");
													
		
	}
	*/

	
}


function appendVisiblePredictionRow(satName, prediction) {

	var localOffsetJulianDay = (((new Date()).getTimezoneOffset()) / 24 / 60);
	
	var startDt = KMG.Astro.formatJulianDay(prediction.startJd-localOffsetJulianDay, true, "M/D HH:mm");
	var startAz = parseInt(prediction.startPosition.azimuth); 
	
	var maxDt = KMG.Astro.formatJulianDay(prediction.maxElevationJd-localOffsetJulianDay, true, "HH:mm");
	var maxElevation = parseInt(prediction.maxElevationPosition.elevation);
	var maxAz = parseInt(prediction.maxElevationPosition.azimuth); 
	
	var endDt = KMG.Astro.formatJulianDay(prediction.endJd-localOffsetJulianDay, true, "HH:mm");
	var endAz = parseInt(prediction.endPosition.azimuth); 
	
	$('#predictions-table > tbody:last').append('<tr class="data-row">' + 
													'<td class="data-table-label">' + satName + '</td>' + 
													'<td class="data-table-value-center">' + startDt + '</td>' + 
													'<td class="data-table-value-center">' + startAz + '&deg;</td>' + 
													'<td class="data-table-value-center">' + ((prediction.locallyVisible) ? "Yes" : "No") + '</td>' + 
													'<td class="data-table-value-center">' + maxDt + '</td>' + 
													'<td class="data-table-value-center">' + maxAz + '&deg;</td>' + 
													'<td class="data-table-value-center">' + maxElevation + '&deg;</td>' + 
													'<td class="data-table-value-center">' + endDt + '</td>' + 
													'<td class="data-table-value-center">' + endAz + '&deg;</td>' + 
													'</tr>');
	

}

function clearPredictions() {
	$("#predictions-table").find("tr").remove();
	$('#predictions-table > tbody:last').append('<tr><td class="data-table-label-center">Click to Update Predictions</td></tr>');
}

function updatePredictions() {
	//return;
	
	if (satellites.length == 0) {
		return;
	}

	
	$("#predictions-table").find("tr").remove();
	
	$('#predictions-table > tbody:last').append('<tr class="data-row">' + 
													'<td class="data-table-label-center">&nbsp;</td>' + 
													'<td class="data-table-label-center" colspan="3">Start</td>' + 
													'<td class="data-table-label-center" colspan="3">Maximum</td>' + 
													'<td class="data-table-label-center" colspan="2">End</td>' + 
													'</tr>');
	
	$('#predictions-table > tbody:last').append('<tr class="data-row">' + 
													'<td class="data-table-label-center">Satellite</td>' + 
													'<td class="data-table-label-center">Date/Time</td>' + 
													'<td class="data-table-label-center">Az</td>' + 
													'<td class="data-table-label-center">Visible</td>' + 
													'<td class="data-table-label-center">Time</td>' + 
													'<td class="data-table-label-center">Az</td>' + 
													'<td class="data-table-label-center">El</td>' +
													'<td class="data-table-label-center">Time</td>' + 
													'<td class="data-table-label-center">Az</td>' +
													'</tr>');
													
	predictionMap = {};

	
	var lat_dms = KMG.Util.formatDegreesToMinutes(locationProvider.getLatitude(), "N", "S");
	var lon_dms = KMG.Util.formatDegreesToMinutes(locationProvider.getLongitude(), "E", "W");
	$("#predictions-header").html("Next Overhead Passes for " + lat_dms + " " + lon_dms);

	var now = timeProvider.getTime();
	var end = now + 3;
	var intervalSeconds = 30;
	var interval = (1 / 24 / 60 / 60) * intervalSeconds; // intervalSeconds * seconds
	for (var jd = now; jd <= end; jd += interval) {
	
		for (var s = 0; s < satellites.activeList.length; s++) {
			var satellite = satellites.activeList[s];
			if (!satellite.isReady()) {
				continue;
			}
			
			var position = satellite.getPositionAtTime(jd);
			if (position && position.elevation > 5 && !predictionMap[satellite.id]) {
				
				predictionMap[satellite.id] = {
					startJd : jd,
					startPosition : position,
					lastElevation : position.elevation,
					maxElevationPosition : position,
					maxElevationJd : jd,
					locallyVisible : position.locallyVisible
				};
				
			
			}
			
			if (predictionMap[satellite.id] && position.locallyVisible) {
				predictionMap[satellite.id].locallyVisible = position.locallyVisible;
			}
			
			if (position && position.elevation > 5 && predictionMap[satellite.id]) {
				if (position.elevation > predictionMap[satellite.id].lastElevation) {
					predictionMap[satellite.id].maxElevationPosition = position;
					predictionMap[satellite.id].maxElevationJd = jd;
					predictionMap[satellite.id].lastElevation = position.elevation;
					
					
				}
			}
			
			if (position && position.elevation < 5 && predictionMap[satellite.id]) {
				predictionMap[satellite.id].endPosition = position;
				predictionMap[satellite.id].endJd = jd;
				
				appendVisiblePredictionRow(satellite.getName(), predictionMap[satellite.id]);
				
				predictionMap[satellite.id] = undefined;
			}

		}
	
	

		
		
	}
	
	
}


function imagePosition(lat, lon, width, height) {
	lat += 90;
	lon += 180;
	
	var x = (lon / 360) * width;
	var y = height - (lat / 180) * height;
	
	return {
		x : x,
		y : y
	};
}


function renderCanvas() {
	mapRenderer.render();
	
}


function getIdListFromQueryString() {
	var satsStr = AppEnv.getUrlVar("sats");
	var satIds = (satsStr) ? KMG.Util.stringToDataType(satsStr) : undefined;
	if (satIds && !(satIds instanceof Array)) {
		satIds = [satIds];
	} else if (!satIds) {
		satIds = [];
	}
	return satIds;
}	

function loadConfigFromQueryString(mapRenderer) {
	var queryConfig = AppEnv.getUrlVar("config");
	if (!queryConfig) {
		return;
	}
	
	config = JSON.parse(decodeURIComponent(queryConfig));
	
	for (var group in config) {
		for (item in config[group]) {
		
			// Only bother with groups and config items that exist
			if (mapRenderer.config[group] && mapRenderer.config[group][item]) {
				mapRenderer.config[group][item] = config[group][item];
			}
		}
	
	}
	
}

$(function() {
	
	//$(".only-with-data").css("display", "none");
	
	// About dialog
	$( "#about-dialog" ).dialog({
		width: 500,
		autoOpen: false,
		show: {
			effect: "drop",
			duration: 400
		},
		hide: {
			effect: "drop",
			duration: 400
		}
	});
	$( "#about-link" ).click(function(e) {
		e.preventDefault();
		$( "#about-dialog" ).dialog("open");
	});
	$( "#about-close-button" ).button().click(function(e) {
		$( "#about-dialog" ).dialog("close");
	});
	
	// Options Dialog
	$( "#options-dialog" ).dialog({
		width: 800,
		autoOpen: false,
		show: {
			effect: "drop",
			duration: 400
		},
		hide: {
			effect: "drop",
			duration: 400
		}
	});
	$( "#options-link" ).click(function(e) {
		e.preventDefault();
		$( "#options-dialog" ).dialog("open");
	});
	$( "#options-close-button" ).button().click(function(e) {
		$( "#options-dialog" ).dialog("close");
	});
	
	// Location Dialog
	$( "#location-dialog" ).dialog({
		width: 500,
		autoOpen: false,
		show: {
			effect: "drop",
			duration: 400
		},
		hide: {
			effect: "drop",
			duration: 400
		}
	});
	$( "#location-link" ).click(function(e) {
		e.preventDefault();
		$( "#location-dialog" ).dialog("open");
	});
	$( "#location-close-button" ).button().click(function(e) {
		$( "#location-dialog" ).dialog("close");
	});
	
	
	
	// Update Predictions Button
	$( "#update-predictions-button" ).button().click(function(e) {
		updatePredictions();
		e.preventDefault();
	});
	
	
	
	// Search box
	
	$( "#search-input" ).autocomplete({
		source: "/api/satellites/list/",
		minLength: 0,
		delay : 0,
		data: {
			max: 15
		},
		select: function( event, ui ) {
			$("#search-submit").button({disabled:false});
		},
		change: function( event, ui ) {
			
		},
		search: function( event, ui ) {
			$("#search-submit").button({disabled:true});
		}
    }).data( "ui-autocomplete" )._renderItem = function( ul, item ) {
		item.value = item.id + " - " + item.name;
		item.label = item.id + " - " + item.name;
		return $( "<li>" )
			.attr( "data-value", item.value )
			.append( $( "<a>" ).text( item.label ) )
			.appendTo( ul );
    };
	
	 $("#search-submit").button({disabled:true}).click(function(e) {
		console.info("Submitted with value: " + $( "#search-input" ).val());
		var fullname = $( "#search-input" ).val();
		var id = fullname.split(" - ")[0];
		var name = fullname.split(" - ")[1];
		
		loadBasic(id);
		
	});
	
	var canvas = document.getElementById("map");
	mapRenderer = new KMG.MapRenderer(canvas, satellites, sunManager, moonManager, locationProvider, timeProvider, mousePosition);
	mapRenderer.addOnRenderCallback(function() {
		// Run following each render
		
		//if (timeProvider.isRealTime()) {
			
			
		//}
		var setTimeToOffset = ((new Date()).getTimezoneOffset()) / 24 / 60;	
		
		$("#realtime-datetime").text(KMG.Astro.formatJulianDay(timeProvider.getTime() - setTimeToOffset, $("#simulate-use-local").prop("checked"), 'MMMM Do YYYY, h:mm:ss a'));
		//$("#realtime-datetime").text(KMG.Astro.formatJulianDay(KMG.Astro.julianNow() - setTimeToOffset, $("#simulate-use-local").prop("checked"), 'MMMM Do YYYY, h:mm:ss a'));
		
		
		
	});
	
	try{
		loadConfigFromQueryString(mapRenderer);
	} catch(e) { console.debug("Parsing config from query string failed"); console.debug(e); }
	
	function setConfig(group, option) {
		$("#config-" + group + "-" + option).click(function(e) { 
			mapRenderer.config[group][option] = $(this).prop("checked"); 
			mapRenderer.render(); 
			clearSatellitePositions();
			updateNavigationState();
		});
		$("#config-" + group + "-" + option).prop("checked", mapRenderer.config[group][option]);
	}
	
	function setConfigSelect(group, option) {
		$("#config-" + group + "-" + option).click(function(e) { 
			mapRenderer.config[group][option] = $(this).val(); 
			mapRenderer.render(); 
			clearSatellitePositions();
			updateNavigationState();
		});
		$(this).val(mapRenderer.config[group][option]);
	}
	
	/*
	setRealTime : setRealTime,
		isRealTime : isRealTime,
		setJulianDay : setJulianDay,
		getJulianDay : getJulianDay,
		getTime : getTime
	*/
	function clearSatellitePositions() {
		for (var i = 0; i < satellites.length; i++) {
			satellites[i].clearPositions();
		}
	}

	var utc = AppEnv.getUrlVar("utc");
	utc = (utc === "true") ? true : false;
	
	var rt = AppEnv.getUrlVar("rt");
	rt = (rt === "true" || !rt) ? true : false;
	
	var setTimeToOffset = (!utc) ? (((new Date()).getTimezoneOffset()) / 24 / 60) : 0;	
	var jd = AppEnv.getUrlVar("jd");
	jd = (jd) ? KMG.Util.stringToDataType(jd) : KMG.Astro.julianNow() - setTimeToOffset;
	

	
	timeProvider.setJulianDay(jd);

	timeProvider.setRealTime(rt);
	$("#realtime-check").prop("checked", timeProvider.isRealTime());
	
	function setRealTimeDisplay(rt) {
		$("#realtime-datetime").css("display", (rt) ? "block" : "none");
		$("#user-set-datetime").css("display", (!rt) ? "block" : "none");
	}
	setRealTimeDisplay(rt);

	$("#realtime-check").click(function(e) {
		setRealTimeDisplay($(this).prop("checked"));
		timeProvider.setRealTime($(this).prop("checked"));
		clearSatellitePositions();
		updateNavigationState();
	});
	
	
	function updateUserDateTime() {
		var dt =$("#simulate-date-time").datetimepicker('getDate').getTime();
										
		var offset = ($("#simulate-use-local").prop("checked")) ? (((new Date()).getTimezoneOffset()) / 24 / 60) : 0;
		
		timeProvider.setJulianDay(KMG.Astro.millisToJulian(dt) + offset);
		clearSatellitePositions();
		updateNavigationState();
	}
	if (utc) {
		$("input:radio[name='simulate-tz'][value='utc']").prop("checked", true);
	} else {
		$("input:radio[name='simulate-tz'][value='local']").prop("checked", true);
	}
	
	$( "#simulate-use-tz-radios" ).buttonset();
	$("input:radio[name='simulate-tz']").click(function(e) {
		updateUserDateTime();
		clearSatellitePositions();
		updateNavigationState();
	});
	
	$("#simulate-date-time").datetimepicker({
									showButtonPanel: true,
									changeMonth: true,
									changeYear: true,
									yearRange : "c-1:c+1",
									onSelect : function(dateText, el) {
										updateUserDateTime();
									}
								});
							
	var setTimeTo = KMG.Astro.julianToDate(jd);
	$("#simulate-date-time").datetimepicker('setDate', setTimeTo);
	
	
	
	setConfig("background", "showMap");
	setConfig("background", "showGrid");
	setConfig("background", "showTimestamp");
	
	setConfig("sun", "showPosition");
	setConfig("sun", "showTerminator");
	setConfig("sun", "showNightShadow");
	setConfig("sun", "showLabel");
	
	setConfig("moon", "showPosition");
	setConfig("moon", "showLabel");
	setConfig("moon", "showVisualRange");
	
	setConfig("satellites", "showTrack");
	setConfig("satellites", "showVisualRange");
	setConfigSelect("satellites", "showNumOrbits");
	setConfig("satellites", "showLabel");
	
	setConfig("location", "showPosition");
	

	
	function updateSun() {
		sunManager.update(function() {
			setTimeout(function() {updateSun()}, 500);
		});
	}
	updateSun();
	
	function updateMoon() {
		moonManager.update(function() {
			setTimeout(function() {updateMoon()}, 500);
		});
	}
	updateMoon();
	
	function render() {
		updateDetailsTable();
		renderCanvas();
		setTimeout(function() {render()}, 250);
	}
	render();
	
	/*
	function updatePredictionsTimer() {
		updatePredictions();
		setTimeout(function() {updatePredictionsTimer()}, 60000);
	}
	updatePredictionsTimer();
	*/
	
	function isNumericKeyEvent(e) {
		//http://stackoverflow.com/questions/995183/how-to-allow-only-numeric-0-9-in-html-inputbox-using-jquery
	    // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl+A
            (e.keyCode == 65 && e.ctrlKey === true) || 
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
                 return true;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
           return false;
        }
		return true;
	}
	
	$("#user-latitude").keydown(function(e) {
		if (!isNumericKeyEvent(e)) {
			e.preventDefault();
		}
	});
	
	$("#user-longitude").keydown(function(e) {
		if (!isNumericKeyEvent(e)) {
			e.preventDefault();
		}
	});
	
	locationProvider.addOnChangeCallback(function(scope) {
		$("#user-latitude").val(scope.getLatitude());
		$("#user-longitude").val(scope.getLongitude());
		clearPredictions();
	});
	
	locationProvider.determine();
	
	$("#set-user-location").button().click(function(e) {
		var lat = parseFloat($("#user-latitude").val());
		var lon = parseFloat($("#user-longitude").val());
		locationProvider.set(lat, lon);
	});
	
	
	$( "#determine-location-button" ).button().click(function(e) {
		locationProvider.determine();
	});
	
	
	//cursor-location
	$("#map").on({
		mouseout : function(event) {
			mousePosition.over = false;
			renderCanvas();
		},
		mouseover : function(event) {
			mousePosition.x = event.offsetX;
			mousePosition.y = event.offsetY;
			mousePosition.over = true;
			renderCanvas();
		},
		mousemove : function(event) {
			mousePosition.x = event.offsetX;
			mousePosition.y = event.offsetY;
			mousePosition.over = true;

			renderCanvas();
		}
	});
	
	
	
	window.onpopstate = function(event) {
		if (event.state) {
			//loadBasic(event.state.id);
		}
	};
	
	var satIds = getIdListFromQueryString();
	for (var i = 0; i < satIds.length; i++) {
		loadBasic(satIds[i]);
	}
	/*
	var qs = getIdFromQueryString();
	if (qs && qs.length > 0) {
		loadBasic(qs);
	}
	*/
	
	$("#search-input").prop("disabled", false);
});	



		</script>
		
	</head>
	<body>
		
		<img src="/img/sprites/pin-icon.png" id="pin-image" class="pin-image resource-image" />
		<img src="/img/sprites/satellite-icon.png" id="satellite-image" class="satellite-image resource-image" />
		<img src="/img/sprites/moon-icon.png" id="moon-image" class="moon-image resource-image" />
		<img src="/img/sprites/sun-icon.png" id="sun-image" class="sun-image resource-image" />
		<img src="/img/sprites/iss-icon.gif" id="iss-image" class="iss-image resource-image" />
		<img src="/img/earth_bluemarble_land_ocean_ice_texture_1024x512.jpg" id="map-image" class="map-image resource-image"/>
	
		<div class="outter-container">
			
			<div class="container-row">
				<div id="page-title-container-inline" class="hide-on-embedded">
					<a href="http://solar.apoapsys.com/satellitetracker.html" id="page-title-link">Satellite Tracking</a>
				</div>	
				
				<div id="social-media-links"  class="hide-on-embedded">
					
					<div class="social-button">
						<!-- Facebook -->
						<div id="fb-root"></div>
						<script>(function(d, s, id) {
						  var js, fjs = d.getElementsByTagName(s)[0];
						  if (d.getElementById(id)) return;
						  js = d.createElement(s); js.id = id;
						  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
						  fjs.parentNode.insertBefore(js, fjs);
						}(document, 'script', 'facebook-jssdk'));</script>
					
						<div class="fb-like" data-href="http://solar.apoapsys.com/satellitetracker.html" data-send="false" data-layout="button_count" data-width="300" data-show-faces="true" data-colorscheme="dark"></div>
					</div>
					
					<div class="social-button">
						<!-- Google+ -->
						<div class="g-plusone" data-size="medium" data-annotation="inline" data-width="250"></div>

						<script type="text/javascript">
						  (function() {
							var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
							po.src = 'https://apis.google.com/js/plusone.js';
							var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
						  })();
						</script>
					</div>
					
					<div class="social-button">
						<!-- Twitter -->
						<a href="https://twitter.com/share" class="twitter-share-button" data-via="kevinmgill" id="tweet-href"></a>
						<script>
							$("#tweet-href").text("Tweet");
							!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
						</script>
					</div>
					
				</div>
			</div>
			
			
			<div class="container-row">
				<div id="search-container" class="box-container box-wide">
					<label for="search-input">Search:</label>
					<input type="text" id="search-input" disabled=true placeholder="Satellite Name or ID"></input>
					<input type="button" id="search-submit" value="Submit" />
					
					<a href="#" id="options-link" class="top-link">[Options]</a>
					<a href="#" id="location-link" class="top-link">[Location]</a>
					<a href="#" id="about-link" class="top-link">[About]</a>
				</div>
				

			</div>
			
			<div class="container-row only-with-data">
				<div id="options-container" class="box-container box-wide">
					<div class="box-header">Date/Time</div>
					
					
					<input type="checkbox" id="realtime-check" />
					<label for="realtime-check">Realtime</label>
					<div id="user-set-datetime" class="time-box">
						<label for="simulate-date-time">Date/Time:</label>
						<input type="text" id="simulate-date-time"></input>
					</div>
					<div id="realtime-datetime" class="time-box">
					
					</div>
					<span id="simulate-use-tz-radios">
						<input type="radio" id="simulate-use-local" name="simulate-tz" value="local" />
						<label for="simulate-use-local">Local</label>
						
						<input type="radio" id="simulate-use-utc" name="simulate-tz" value="utc" />
						<label for="simulate-use-utc">UTC</label>
					</span>
		
					
				</div>
				
				
			</div>
			
			
			<div class="container-row only-with-data">
				<div id="details-container" class="box-container box-wide">
					<div class="box-header">Details</div>
					<table id="details-table" class="data-table">
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
			
			<div class="container-row only-with-data">
				<div id="map-container" class="box-container box-wide">
					<div class="box-header">Map</div>
					<canvas id="map" width="840px" height="420px"/>
					
				</div>
			</div>
			
			
			<div class="container-row only-with-data">
				<div id="predictions-container" class="box-container box-wide">
					<div id="predictions-header" class="box-header">Predictions</div>
					<input type="button" id="update-predictions-button" value="Update Predictions" />
					<table id="predictions-table" class="data-table">
						<tbody>
							<tr><td class="data-table-label-center">Click to Update Predictions</td></tr>
						</tbody>
					</table>
				</div>
			</div>
			
			
			<div class="container-row">
				<table class="data-table">
					<tbody>
						<tr>
							<td>
								&copy; <a href="http://www.apoapsys.com">Kevin M. Gill</a> 2014
							</td>
							<td>
								<a href="#">Back to top</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
			
		<div id="options-dialog" title="Options">
			<h1>Options</h1>
		
			<div class="dialog-section">
			
				<fieldset id="config-background">
					<legend>General</legend>
					
					<input type="checkbox" id="config-background-showMap"/>
					<label for="config-background-showMap">Show Map</label>
					<br/>
					<input type="checkbox" id="config-background-showGrid"/>
					<label for="config-background-showGrid">Show Grid</label>
					<br/>
					<input type="checkbox" id="config-location-showPosition"/>
					<label for="config-location-showPosition">Show My Position</label>
					<br/>
					<input type="checkbox" id="config-background-showTimestamp"/>
					<label for="config-background-showTimestamp">Show Timestamp</label>
				</fieldset>
				<fieldset id="config-moon">
					<legend>Moon</legend>
					
					<input type="checkbox" id="config-moon-showPosition"/>
					<label for="config-moon-showPosition">Show Position</label>
					<br/>
					<input type="checkbox" id="config-moon-showLabel"/>
					<label for="config-moon-showLabel">Show Label</label>
					<br/>
					<input type="checkbox" id="config-moon-showVisualRange"/>
					<label for="config-moon-showVisualRange">Show Visual Range</label>
				</fieldset>
				<fieldset id="config-sun">
					<legend>Sun</legend>
					
					<input type="checkbox" id="config-sun-showPosition"/>
					<label for="config-sun-showPosition">Show Position</label>
					<br/>
					<input type="checkbox" id="config-sun-showTerminator"/>
					<label for="config-sun-showTerminator">Show Terminator</label>
					<br/>
					<input type="checkbox" id="config-sun-showNightShadow"/>
					<label for="config-sun-showNightShadow">Show Night Shadow</label>
					<br/>
					<input type="checkbox" id="config-sun-showLabel"/>
					<label for="config-sun-showLabel">Show Label</label>
				</fieldset>
				
				<fieldset id="config-satellites">
					<legend>Satellites</legend>
					
					<input type="checkbox" id="config-satellites-showTrack"/>
					<label for="config-satellites-showTrack">Show Track</label>
					<br/>
					<input type="checkbox" id="config-satellites-showVisualRange"/>
					<label for="config-satellites-showVisualRange">Show Visual Range</label>
					<br/>
					<input type="checkbox" id="config-satellites-showLabel"/>
					<label for="config-satellites-showLabel">Show Label</label>
					<br/>
					
					<label for="config-satellites-showNumOrbits">Number of Orbits to Display:</label>
					<select id="config-satellites-showNumOrbits">
						<option>1</option>
						<option>2</option>
						<option>3</option>
						<option>4</option>
						<option>5</option>
						<option>6</option>
						<option>7</option>
						<option>8</option>
					</select>
				</fieldset>
			
			</div>
			<p>
				<input type="button" value="Close" id="options-close-button"/>
			</p>
		</div>
			
			
		<div id="location-dialog" title="Location">
			<h1>Location</h1>
			
			<div class="dialog-section">

				<table class="config-table">
					<tbody>
						<tr>
							<td colspan="3">
								<input type="button" value="Determine My Location" id="determine-location-button"/>
							</td>
						</tr>
						<tr>
							<td class="data-table-label">
								Latitude:
							</td>
							<td colspan="2">
								<input type="text" id="user-latitude" />
							</td>
						</tr>
						<tr>
							<td class="data-table-label">
								Longitude:
							</td>
							<td>
								<input type="text" id="user-longitude" />
							</td>
							<td>
								<input type="button" id="set-user-location" value="Update" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<p>
				<input type="button" value="Close" id="location-close-button"/>
			</p>
		
		</div>
		<div id="about-dialog" title="About">
			<h1><a href="/satellitetracker.html">Satellite Tracker</a></h1>
			
			<div class="dialog-section">
				Real-time and simulated satellite positions and tracking
			</div>
			
			<div class="dialog-section">
				Data Source: <a href="http://www.celestrak.com/" title="CelesTrak">CelesTrak Two-Line Element (TLE) Sets</a>
			</div>
			
			<div class="dialog-section">
				&copy; <a href="http://www.apoapsys.com">Kevin M. Gill</a> 2014
			</div>
			
			<p>
				<input type="button" value="Close" id="about-close-button"/>
			</p>
		</div>
		
		<script>	
if (!AppEnv.isDevMode() && !AppEnv.noAnalytics()) {

  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3932152-11', 'apoapsys.com');
  ga('send', 'pageview', {
	'dimension1' : 'Satellite Tracker'
  });

}
		</script>
	</body>
</html>
	
